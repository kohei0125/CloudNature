# 要件定義書 & プロンプトエンジニアリング設計書：CloudNature AI見積もりシステム

### 1. プロジェクト概要

**目的**

CloudNature（[cloudnature.jp](https://ai.cloudnature.jp/)）におけるリード獲得と商談化プロセスの自動化。

**全体フロー**

- **Phase A (システム範囲):** ユーザーがWeb上で要件入力 → AIが「概算見積・要件定義」を即時生成・送付
- **Phase B (商談接続):** 成果物を見たユーザーが、記載されたリンクから「詳細ヒアリング」を予約 → 専門家が正式見積提示
- **Phase C (開発):** 成約後、「AI:人間 = 8:2」のハイブリッド体制で高速開発

**システムのゴール**

フェーズAを完結させ、フェーズB（初回商談）への予約率を最大化すること。

**確定方針（2026-02-15）**

- 価格訴求は「通常比40%OFF（=通常価格の60%）」で統一する
- ユーザー入力データの保存期間は1ヶ月（31日）とする
- 生成PDFは法的拘束力のない概算見積として扱う

---

### 2. システム構成案

| **レイヤー** | **技術スタック** | **用途** |
| --- | --- | --- |
| Frontend | Next.js / React | 対話型フォーム |
| Backend | Python (FastAPI) | API処理・ビジネスロジック |
| AI Engine | LLM Adapter Layer（Primary: OpenAI API） | 動的質問生成・見積算出 |
| PDF Generation | React-pdf | 見積書・要件定義書の動的生成 |
| Scheduling | Calendly or Spir 連携 | 商談予約リンク埋め込み |

---

### 3. 機能要件：フェーズA（対話型自動見積もり）

### 3.1 対話型ヒアリングフォーム (Chat UI)

全15ステップ。ユーザーの入力負荷を下げつつ、Phase B（専門家ヒアリング）で役立つ情報を集める。

| **Step** | **項目名** | **形式** | **AI挙動・備考** |
| --- | --- | --- | --- |
| 01 | 事業形態 | 選択 | 法人 / 個人事業主 |
| 02 | システム概要 | 記述 | 500文字以内 |
| 03 | 業種 | 選択 | 9択 |
| 04 | 従業員規模 | 選択 | 5択 |
| 05 | 導入先 | 選択 | 自社 / クライアント |
| 06 | システム種類 | 選択 | Webアプリ / スマホアプリ等 |
| 07 | 現状確認 | 選択 | 【AI生成】概要に基づき、リプレイスか新規かを判断する質問を生成 |
| 08 | 現状詳細 | 選択+記述 | 【条件分岐】Step7で既存ありの場合、主要ツールをボタン選択。「その他」の場合のみ自由記述 |
| 09 | 機能提案 | 複数選択 | 【AI生成】「このシステムならこの機能が必要では?」と5〜8個を提案しCheckさせる |
| 10 | 特殊要件 | 記述 | こだわりポイント |
| 11 | 商談状況 | 記述 | 他社比較状況 |
| 12 | 導入時期 | 選択 | 5択 |
| 13 | デバイス | 複数選択 | PC / スマホ等 |
| 14 | 予算感 | 選択 | 8段階（〜50万、〜100万...）+「わからない/提案してほしい」「未定」 |
| 15 | 送付先Email | 入力 | メールアドレス |

### 3.1.1 フォームUI/UX要件

- **離脱防止・再開機能:** 各ステップに「戻る」「終了する」ボタンを設置
- セッションを維持し、ユーザーが途中で離脱しても再開できるよう配慮
- プログレスバーで進捗を可視化
- モバイル対応（レスポンシブデザイン）

### 3.1.2 データ保持・セキュリティ要件

- 保存期間: フォーム入力データ・生成成果物メタデータは保存から1ヶ月（31日）で自動削除
- 送信データ最小化: LLMへ送る入力には、見積生成に不要な個人情報（例: メールアドレス）を含めない
- 同意取得: 送信前に「概算見積生成のためのデータ利用」への同意チェックを必須化
- 監査性: 削除ジョブの実行ログを保持し、削除漏れを検知可能にする

### 3.2 成果物自動生成・送付機能 (Phase A → B へのブリッジ)

入力完了後、以下の2点を生成しメール送付する。「これは概算であり、正式見積もりには面談が必要」という導線を徹底する。

### 3.2.1 概算見積書 (PDF)

**コンセプト:** 「AI:人間 = 8:2」のハイブリッド開発によるコストメリットの可視化

**必須項目:**

- **ハイブリッド割引表示:** 「通常開発費」と「AIハイブリッド開発費（通常比40%OFF）」を並記
- **機能ごとの費用明示:** プロジェクト管理費やUI/UX設計費などの固定費に加え、機能ごとに工数（人日）と費用を明示し、価格の透明性を担保
- **免責事項:** 「本見積もりはAIによる概算であり、法的拘束力を持ちません。正確な金額は専門エンジニアによる詳細ヒアリング後に確定します」と明記
- **Next Action:** 「この見積もり内容で専門家に相談する（無料）」ボタン/リンクを配置

### 3.2.2 要件定義書 (PDFスライド形式)

**構成:**

- **プロジェクト概要:** AIが解釈したシステム像
- **機能一覧:** Step9で選択された機能 + AIが補完した必須機能
- **開発体制図:** AIとエンジニアの役割分担図（8:2モデルの図解）
- **ヒアリングアジェンダ:** Phase Bの面談で話し合うべき「未確定事項（AIが判断できなかった点）」をリスト化し、面談の価値をアピール
- **会社紹介・開発実績:** 信頼性補強のため、会社概要、代表者情報、開発実績（通常開発との比較）を掲載

---

### 4. プロンプトエンジニアリング設計

### 4.0 プロンプト管理方針

- プロンプトはアプリ本体コードに直書きせず、別ファイルに切り分けて管理する
- 運用中の改善に対応するため、プロンプトファイルは随時更新可能とする
- API実行時は対象バージョンのプロンプトファイルを読み込み、変更履歴を追跡できる状態を維持する

### 4.0.1 LLM API変更耐性の設計方針

- OpenAI SDK/APIをアプリケーション層から直接呼ばず、`LLM Adapter` 経由で呼び出す
- アプリ側の入出力契約は固定し、プロバイダ固有差分（エンドポイント、パラメータ名、レスポンス形式）はAdapter内で吸収する
- モデル名・タイムアウト・リトライ回数は設定ファイルで切替可能にし、コード修正なしで変更できるようにする
- 生成APIの戻り値は常にサーバー側で正規化してから利用し、未対応フィールドは無視可能な実装とする
- OpenAI障害/仕様変更時はフォールバック（固定テンプレート返却）でフェーズAを継続可能にする

### 検証1：動的質問・機能リスト生成 (Step 07-09用)

**目的:** Phase Bのヒアリングをスムーズにするため、Step9の時点で「的はずれな機能」を提案しないよう精度を高める。

**System Prompt:**

```
あなたは熟練のWebシステム開発ディレクターです。
ユーザーの「作りたいシステム概要」に基づき、Phase B（有人ヒアリング）の前段階として確認すべき項目を生成してください。

# ユーザー情報
- システム概要: {{user_overview}}
- システム種類: {{system_type}}

# 出力フォーマット (JSON)
{
  "step7_question": "現状のシステム環境を確認する質問（YES/NO形式推奨）",
  "step9_recommended_features": [
    "機能A（必須級）",
    "機能B（差別化要因）",
    "機能C",
    "機能D",
    "機能E"
  ]
}
```

### 検証2：見積もり・要件定義データ生成 (成果物用)

**目的:** Phase C（開発）の「AIハイブリッド開発」ロジックに基づき、安さの根拠を提示する。

**System Prompt:**

```
あなたは、AIによる自動テストと少数精鋭のエンジニアによる高速開発を信条とするCloudNatureのPMです。
ユーザー入力に基づき、概算見積もりと要件定義データをJSONで出力してください。

# 計算ロジック (Phase C前提)
1. まず一般的なSIerでの開発工数（Standard Man-days）を算出する。
2. そのうち80%の工程（コーディング、テスト等）をAIで効率化し、工数を1/2に圧縮する。
3. 残り20%（要件定義、品質管理）は人間が行う。
4. 結果として、総額で**通常比60%程度の価格（=40%OFF）**になるように調整する。

# ユーザー入力履歴
{{user_input_history_full}}

# 出力フォーマット (JSON)
{
  "project_name": "プロジェクト名",
  "summary": "要件定義書の「はじめに」用テキスト",
  
  "development_model_explanation": "本プロジェクトは、AIが実装の8割を担当し、残り2割の重要箇所を専門エンジニアが担当する『ハイブリッド開発』で進行します。",

  "features": [
    {
      "name": "機能名",
      "detail": "機能詳細",
      "standard_price": 100000,
      "hybrid_price": 60000
    }
  ],

  "discussion_agenda": [
    "決済代行会社の選定（Stripe or PAY.JP?）",
    "既存データベースとの連携仕様の詳細",
    "リリース後の保守プランについて"
  ],

  "total_cost": {
    "standard": 0,
    "hybrid": 0,
    "message": "AIハイブリッド開発により、通常相場より約40%のコストダウンが見込まれます。"
  }
}
```

### 4.1 出力バリデーション要件（実装必須）

- Step7/Step9および成果物JSONは、サーバー側でJSON Schema検証を行う
- 検証失敗時は最大2回まで再生成し、それでも失敗した場合はフォールバックテンプレートを返す
- 金額項目は `hybrid_price = round(standard_price * 0.6)` を基準式とする
